import{_ as s,o as a,c as p,b as t}from"./app-D-TC3Ll_.js";const n="/sake-s-blog/assets/QQ%E5%9B%BE%E7%89%8720230211161756-C242BhH6.png",o="/sake-s-blog/assets/image-20230211142133997-CnVNVkSX.png",e="/sake-s-blog/assets/image-20230211142210032-BNy_XWbo.png",c="/sake-s-blog/assets/image-20230211142648570-B1xIGa8h.png",l="/sake-s-blog/assets/image-20230211143940188-CxvavYis.png",i="/sake-s-blog/assets/image-20230211150434753-D7fMLb8l.png",u="/sake-s-blog/assets/image-20230211152011752-D-BREv6J.png",r="/sake-s-blog/assets/image-20230211152205363-DQIhe_Jv.png",k="/sake-s-blog/assets/image-20230211153057317-Bhe5Ped8.png",d="/sake-s-blog/assets/image-20230211153219409-DvgaLhyr.png",m="/sake-s-blog/assets/image-20230211154011725-CgOTwF0H.png",v="/sake-s-blog/assets/image-20230211160113556-AaEVrMBk.png",g="/sake-s-blog/assets/image-20230211154505128-D9UTZSJJ.png",b="/sake-s-blog/assets/image-20230211155415536-PTetqqWk.png",q="/sake-s-blog/assets/image-20230211155952042-D8Qkjifm.png",y="/sake-s-blog/assets/image-20230211161407478-D3M7QCZC.png",f={},h=t('<blockquote><p>如果你问我人生梦想是什么？</p><p>我可能会说：有什么天天嫖麦当劳优惠券狠狠吃更棒的事了呢😋</p><p><img src="'+n+'" alt="QQ图片20230211161756"></p></blockquote><blockquote><p><strong>本文所谈及技术只为网络安全人员进行服务器检测或维护参考，仅供学习交流，请勿用于违法用途。</strong></p></blockquote><p><strong>（碰壁了很多次，js代码经过混淆的可读性很差，代码量太大期间火狐崩溃了好几次😭）</strong></p><p>页面: <code>aHR0cHM6Ly9jZG4ubWNkLmNuL2Ntcy9wYWdlcy9RUXdhbGxldC5odG1s</code></p><p>首先抓取<strong>一键领取</strong>的数据包进行分析</p><p><img src="'+o+'" alt="image-20230211142133997"></p><p><img src="'+e+'" alt="image-20230211142210032"></p><blockquote><ul><li>尝试修改<code>receiveQuantity</code>为2，返回领取失败</li></ul></blockquote><p>对比两次请求可以发现，payload没有发生变化，改变的是请求头的<code>Nonce</code>，<code>St</code>，<code>Sign</code>参数，而且容易看出<code>St</code>参数是时间戳，<code>Nonce</code>参数是时间戳拼接了一段字符串</p><p><img src="'+c+'" alt="image-20230211142648570"></p><p>而请求前并未有<code>GetSign</code>相关请求，因此考虑是js本地进行<code>Sign</code>的生成，定位<code>Onclick</code>过程的js</p><p><img src="'+l+'" alt="image-20230211143940188"></p><blockquote><ul><li>尝试搜索请求的url：<code>/bff/member/coupon/bind</code>，缩短为<code>/coupon/bind</code>搜索，发现<code>couponsBind</code>函数（后续弯弯绕绕没有发现有用信息）</li></ul><p><img src="'+i+'" alt="image-20230211150434753"></p></blockquote><p>尝试搜索：<code>sign</code>，结果太多；搜索<code>.sign</code>，设置断点调试，得出<code>Object(i.sign)(t,{})</code>，<code>i.sign</code>是个函数对象，对 t 进行处理，返回了<code>sign</code>值</p><p><img src="'+u+'" alt="image-20230211152011752"></p><p><img src="'+r+'" alt="image-20230211152205363"></p><p>发现<code>c(e)</code>里调用了<code>u(n,t)</code>进行处理，继续断点调试，我们深入到该函数，发现调用了<code>e(b)</code></p><p><img src="'+k+'" alt="image-20230211153057317"></p><p><img src="'+d+`" alt="image-20230211153219409"></p><p>我们将所有相关的函数全部扒到本地，并把一些固定字符串列表的索引给直接取出字符串来赋值（x = test[1] -&gt; x = &#39;helloworld&#39;）</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="line"><span class="token comment">// &quot;e0a803e042c3f658cf31d9b09454f914&quot;</span></span>
<span class="line"><span class="token keyword">var</span> n <span class="token operator">=</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token function-variable function">wordsToBytes</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> <span class="token number">32</span> <span class="token operator">*</span> e<span class="token punctuation">.</span>length<span class="token punctuation">;</span> n <span class="token operator">+=</span> <span class="token number">8</span><span class="token punctuation">)</span> t<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>e<span class="token punctuation">[</span>n <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">24</span> <span class="token operator">-</span> n <span class="token operator">%</span> <span class="token number">32</span> <span class="token operator">&amp;</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> t</span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function-variable function">bytesToHex</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> e<span class="token punctuation">.</span>length<span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span> t<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    t<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">15</span> <span class="token operator">&amp;</span> e<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> n <span class="token keyword">in</span> e<span class="token punctuation">)</span> t<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> t</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">r</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> n <span class="token keyword">in</span> e<span class="token punctuation">)</span> t<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>e<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> t</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> e<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;Illegal argument &#39;</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">var</span> n <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">wordsToBytes</span><span class="token punctuation">(</span><span class="token function">u</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> t <span class="token operator">&amp;&amp;</span> t<span class="token punctuation">.</span>asBytes <span class="token operator">?</span> n <span class="token operator">:</span> t <span class="token operator">&amp;&amp;</span> t<span class="token punctuation">.</span>asString <span class="token operator">?</span> a<span class="token punctuation">.</span><span class="token function">bytesToString</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">:</span> r<span class="token punctuation">.</span><span class="token function">bytesToHex</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">var</span> <span class="token function-variable function">u</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">var</span> i <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">void</span> <span class="token number">0</span> <span class="token operator">!==</span> arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">?</span> arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    u <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token string-property property">&quot;channelCode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;03&quot;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token string-property property">&quot;coupons&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">              <span class="token string-property property">&quot;couponId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;156BBFBC389F9EA666E2FACD40BC5605&quot;</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token string-property property">&quot;receiveQuantity&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token string-property property">&quot;newUserFlag&quot;</span><span class="token operator">:</span> <span class="token number">0</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">              <span class="token string-property property">&quot;couponId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;45F09AFEE6E455A7175B1085C5012321&quot;</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token string-property property">&quot;receiveQuantity&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">              <span class="token string-property property">&quot;newUserFlag&quot;</span><span class="token operator">:</span> <span class="token number">0</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token string-property property">&quot;pageId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lRLlag9R&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;headers&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token string-property property">&quot;ct&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ct=10&quot;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token string-property property">&quot;nonce&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nonce=1676061464467544235&quot;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token string-property property">&quot;sid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sid=c9643a4402552c67ca7a5a75cdee70b4_&quot;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token string-property property">&quot;st&quot;</span><span class="token operator">:</span> <span class="token string">&quot;st=1676061464&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string-property property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://api.mcd.cn/bff/member/coupon/bind&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    u<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>ct <span class="token operator">=</span> u<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>ct <span class="token operator">||</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">var</span> c <span class="token operator">=</span> u<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>ct<span class="token punctuation">,</span></span>
<span class="line">    s <span class="token operator">=</span> o<span class="token punctuation">.</span>env<span class="token punctuation">,</span></span>
<span class="line">    l <span class="token operator">=</span> <span class="token string">&#39;71d414c0-8fe1-495d-ac55-207414632479&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// s || (s = u.url.match(/-dev\\./) ? &#39;dev&#39; : u.url.match(/-sit\\./) ? &#39;sit&#39; : u.url.match(/-uat\\./) ? &#39;uat&#39; : u.url.match(/-pt\\./) ? &#39;pt&#39; : &#39;prd&#39;),</span></span>
<span class="line">    n<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>l <span class="token operator">=</span> n<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">||</span> t<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>u<span class="token punctuation">.</span>path <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">a</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">===</span> u<span class="token punctuation">.</span>params<span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token number">0</span> <span class="token operator">===</span> u<span class="token punctuation">.</span>params<span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token number">1</span> <span class="token operator">===</span> u<span class="token punctuation">.</span>params<span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">||</span> u<span class="token punctuation">.</span>params<span class="token punctuation">[</span>e<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token number">0</span> <span class="token operator">===</span> u<span class="token punctuation">.</span>params<span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">?</span> f<span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">=</span> e <span class="token operator">+</span> <span class="token string">&#39;=true&#39;</span> <span class="token operator">:</span> <span class="token operator">!</span><span class="token number">1</span> <span class="token operator">===</span> u<span class="token punctuation">.</span>params<span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">?</span> f<span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">=</span> e <span class="token operator">+</span> <span class="token string">&#39;=false&#39;</span> <span class="token operator">:</span> f<span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">=</span> e <span class="token operator">+</span> <span class="token string">&#39;=&#39;</span> <span class="token operator">+</span> u<span class="token punctuation">.</span>params<span class="token punctuation">[</span>e<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    u<span class="token punctuation">.</span>params <span class="token operator">=</span> f<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    p <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">      <span class="token string">&#39;ct&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&#39;language&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&#39;ov&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&#39;p&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&#39;sid&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&#39;token&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&#39;v&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&#39;st&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&#39;nonce&#39;</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">a</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">===</span> u<span class="token punctuation">.</span>headers<span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">||</span> u<span class="token punctuation">.</span>headers<span class="token punctuation">[</span>e<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> p<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>d<span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">=</span> e <span class="token operator">+</span> <span class="token string">&#39;=&#39;</span> <span class="token operator">+</span> u<span class="token punctuation">.</span>headers<span class="token punctuation">[</span>e<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    u<span class="token punctuation">.</span>headers <span class="token operator">=</span> d<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">var</span> h <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    v <span class="token operator">=</span> <span class="token number">101</span> <span class="token operator">===</span> c <span class="token operator">||</span> <span class="token number">102</span> <span class="token operator">===</span> c <span class="token operator">?</span> <span class="token string">&#39;#&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;&amp;&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&#39;#&#39;</span> <span class="token operator">===</span> v <span class="token operator">&amp;&amp;</span> h<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">r</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> u<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token string">&quot;{\\&quot;channelCode\\&quot;:\\&quot;03\\&quot;,\\&quot;coupons\\&quot;:[{\\&quot;couponId\\&quot;:\\&quot;156BBFBC389F9EA666E2FACD40BC5605\\&quot;,\\&quot;receiveQuantity\\&quot;:1,\\&quot;newUserFlag\\&quot;:0},{\\&quot;couponId\\&quot;:\\&quot;45F09AFEE6E455A7175B1085C5012321\\&quot;,\\&quot;receiveQuantity\\&quot;:1,\\&quot;newUserFlag\\&quot;:0}],\\&quot;pageId\\&quot;:\\&quot;lRLlag9R\\&quot;}&quot;</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token string">&#39;{}&#39;</span> <span class="token operator">!==</span> y <span class="token operator">&amp;&amp;</span> h<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">var</span> m<span class="token punctuation">,</span></span>
<span class="line">    g <span class="token operator">=</span> <span class="token function">r</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>g <span class="token operator">&amp;&amp;</span> h<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">,</span> h<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;,&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;&amp;&#39;</span> <span class="token operator">===</span> v <span class="token operator">&amp;&amp;</span> h<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">r</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>h <span class="token operator">=</span> h<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> e <span class="token operator">&amp;&amp;</span> <span class="token string">&#39;{}&#39;</span> <span class="token operator">!==</span> e</span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      l <span class="token operator">?</span> h<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;key=&#39;</span> <span class="token operator">+</span> l<span class="token punctuation">)</span> <span class="token operator">:</span> console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&#39;[WARN] ct=&#39;</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">&#39; is not in pre-defined keys.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">var</span> b <span class="token operator">=</span> h<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">//   i.debug &amp;&amp; console.log(&#39;[DEBUG] @omc/api-signer - plainText: &#39;, b),</span></span>
<span class="line">      m <span class="token operator">=</span> <span class="token function">e</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> m</span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">n <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string-property property">&quot;putChannel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;03&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;pageId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lRLlag9R&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;cityCode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;310100&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;sid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;c9643a4402552c67ca7a5a75cdee70b4_&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;headers&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string-property property">&quot;common&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;Accept&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/json, text/plain, */*&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;delete&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;get&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;head&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;post&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/x-www-form-urlencoded&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;put&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/x-www-form-urlencoded&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;patch&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/x-www-form-urlencoded&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;tid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;00003TuM&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;sid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;c9643a4402552c67ca7a5a75cdee70b4_&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;sv&quot;</span><span class="token operator">:</span> <span class="token string">&quot;v3&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;nonce&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1676058630105631320&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;st&quot;</span><span class="token operator">:</span> <span class="token number">1676058630</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;ct&quot;</span><span class="token operator">:</span> <span class="token number">10</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://api.mcd.cn/bff/member/page/coupon/customer/getable&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">bgg <span class="token operator">=</span> <span class="token string">&quot;{\\&quot;channelCode\\&quot;:\\&quot;03\\&quot;,\\&quot;coupons\\&quot;:[{\\&quot;couponId\\&quot;:\\&quot;156BBFBC389F9EA666E2FACD40BC5605\\&quot;,\\&quot;receiveQuantity\\&quot;:1,\\&quot;newUserFlag\\&quot;:0},{\\&quot;couponId\\&quot;:\\&quot;45F09AFEE6E455A7175B1085C5012321\\&quot;,\\&quot;receiveQuantity\\&quot;:1,\\&quot;newUserFlag\\&quot;:0}],\\&quot;pageId\\&quot;:\\&quot;lRLlag9R\\&quot;}&amp;ct=10&amp;nonce=1676060716058879900&amp;sid=c9643a4402552c67ca7a5a75cdee70b4_&amp;st=1676060716&amp;key=71d414c0-8fe1-495d-ac55-207414632479&quot;</span></span>
<span class="line"><span class="token comment">// &quot;cityCode=310100&amp;pageId=lRLlag9R&amp;putChannel=03&amp;sid=c9643a4402552c67ca7a5a75cdee70b4_&amp;ct=10&amp;nonce=1676058630105631320&amp;sid=c9643a4402552c67ca7a5a75cdee70b4_&amp;st=1676058630&amp;key=71d414c0-8fe1-495d-ac55-207414632479&quot;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">e</span><span class="token punctuation">(</span>bgg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>尝试运行，结果栈溢出报错，因为发生了死循环</p><p><img src="`+m+'" alt="image-20230211154011725"></p><blockquote><ul><li>补充nonce和st的获取</li><li><img src="'+v+'" alt="image-20230211160113556"></li></ul></blockquote><p>经过分析，我们发现，<code>u(e,t)</code>并不是前面所提到的u，而是一个新的函数。而且关键性的，我们发现了该函数下存在<code>1732584193</code>等幻数，这些是MD5加密的特征</p><p><img src="'+g+'" alt="image-20230211154505128"></p><p>所以<code>e(b)</code>本质就是将 b 进行了MD5加密，我们断点调试截获 b 来验证一下</p><p><img src="'+b+'" alt="image-20230211155415536"></p><p><img src="'+q+`" alt="image-20230211155952042"></p><p>成功破解<code>sign</code>的加密逻辑🎉🎉</p><blockquote><p>后续：尝试写个python脚本</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre class="language-python"><code><span class="line"><span class="token keyword">import</span> time</span>
<span class="line"><span class="token keyword">import</span> random</span>
<span class="line"><span class="token keyword">import</span> hashlib</span>
<span class="line"><span class="token keyword">import</span> requests</span>
<span class="line"></span>
<span class="line">st <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">nonce <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>st<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span><span class="token number">999999</span> <span class="token operator">*</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;000&#39;</span></span>
<span class="line">m <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;cityCode=310100&amp;pageId=lRLlag9R&amp;putChannel=03&amp;sid=b4ccde8d6f2e6256ddfce3b3f4ef3dca_&amp;ct=10&amp;nonce=</span><span class="token interpolation"><span class="token punctuation">{</span>nonce<span class="token punctuation">}</span></span><span class="token string">&amp;sid=b4ccde8d6f2e6256ddfce3b3f4ef3dca_&amp;st=</span><span class="token interpolation"><span class="token punctuation">{</span>st<span class="token punctuation">}</span></span><span class="token string">&amp;key=71d414c0-8fe1-495d-ac55-207414632479&quot;</span></span></span>
<span class="line">sign <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>m<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">&#39;UTF-8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>st<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> sign<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;channelCode&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;03&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;coupons&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;couponId&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;156BBFBC389F9EA666E2FACD40BC5605&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;receiveQuantity&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;newUserFlag&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;couponId&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;45F09AFEE6E455A7175B1085C5012321&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;receiveQuantity&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;newUserFlag&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;pageId&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;lRLlag9R&quot;</span><span class="token punctuation">}</span></span>
<span class="line">url <span class="token operator">=</span> <span class="token string">&#39;https://api.mcd.cn/bff/member/coupon/bind&#39;</span></span>
<span class="line">headers <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&#39;Host&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;api.mcd.cn&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;User-Agent&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/109.0&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;Accept&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;application/json, text/plain, */*&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;Accept-Language&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;Accept-Encoding&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;gzip, deflate&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;Content-Type&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;application/json&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;tid&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;00003TuM&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;sid&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;b4ccde8d6f2e6256ddfce3b3f4ef3dca_&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;sv&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;v3&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;nonce&#39;</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f&#39;</span><span class="token interpolation"><span class="token punctuation">{</span>nonce<span class="token punctuation">}</span></span><span class="token string">&#39;</span></span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;st&#39;</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f&#39;</span><span class="token interpolation"><span class="token punctuation">{</span>st<span class="token punctuation">}</span></span><span class="token string">&#39;</span></span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;ct&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;10&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;sign&#39;</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f&#39;</span><span class="token interpolation"><span class="token punctuation">{</span>sign<span class="token punctuation">}</span></span><span class="token string">&#39;</span></span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;Content-Length&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;220&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;Origin&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;https://cdn.mcd.cn&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;Referer&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;https://cdn.mcd.cn/&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;Sec-Fetch-Dest&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;empty&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;Sec-Fetch-Mode&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;cors&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;Sec-Fetch-Site&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;same-site&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;Te&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;trailers&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;Connection&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;close&#39;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment"># res = requests.get(&#39;https://api.mcd.cn/bff/member/page/coupon/customer/getable?putChannel=03&amp;pageId=lRLlag9R&amp;cityCode=310100&amp;sid=b4ccde8d6f2e6256ddfce3b3f4ef3dca_&#39;,headers=headers)</span></span>
<span class="line">res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>草，竟然报错显示<strong>缺少参数</strong>，怎么回事呢😢（在Burp-Proxy截获的数据包中success，Burp-Repeater则不行）</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre class="language-text"><code><span class="line">{&quot;success&quot;:false,&quot;code&quot;:400,&quot;message&quot;:&quot;缺少参数&quot;,&quot;datetime&quot;:&quot;2023-02-11 16:04:17&quot;,&quot;traceId&quot;:&quot;3563b509-808d-4582-907d-19fe5a2feb6e&quot;,&quot;data&quot;:null}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>看来无法实现自动发包领取了，然后就狠狠的进行了脚本录制🥬给两个号都嫖了四百张券（</p><p><img src="`+y+'" alt="image-20230211161407478"></p><p><img src="'+n+'" alt="QQ图片20230211161756"></p></blockquote><p>后续:第二天已修复(火速)🐶😡</p>',32),w=[h];function _(j,C){return a(),p("div",null,w)}const B=s(f,[["render",_],["__file","jiyiciJSnixiang：pojiemaidanglao-sign-canshujiamiluoji.html.vue"]]),A=JSON.parse(`{"path":"/blogs/jishu/jiyiciJSnixiang：pojiemaidanglao-sign-canshujiamiluoji.html","title":"记一次JS逆向：破解麦当劳 sign 参数加密逻辑","lang":"zh-CN","frontmatter":{"title":"记一次JS逆向：破解麦当劳 sign 参数加密逻辑","mathjax":true,"date":"2023/02/11","tags":["Web","jsReverse","SRC"],"categories":["技术"],"description":"如果你问我人生梦想是什么？ 我可能会说：有什么天天嫖麦当劳优惠券狠狠吃更棒的事了呢😋 QQ图片20230211161756 本文所谈及技术只为网络安全人员进行服务器检测或维护参考，仅供学习交流，请勿用于违法用途。 （碰壁了很多次，js代码经过混淆的可读性很差，代码量太大期间火狐崩溃了好几次😭） 页面: aHR0cHM6Ly9jZG4ubWNkLmN...","head":[["meta",{"property":"og:url","content":"https://sakee.cn/sake-s-blog/blogs/%E6%8A%80%E6%9C%AF/%E8%AE%B0%E4%B8%80%E6%AC%A1JS%E9%80%86%E5%90%91%EF%BC%9A%E7%A0%B4%E8%A7%A3%E9%BA%A6%E5%BD%93%E5%8A%B3-sign-%E5%8F%82%E6%95%B0%E5%8A%A0%E5%AF%86%E9%80%BB%E8%BE%91.html"}],["meta",{"property":"og:site_name","content":"sake's blog"}],["meta",{"property":"og:title","content":"记一次JS逆向：破解麦当劳 sign 参数加密逻辑"}],["meta",{"property":"og:description","content":"如果你问我人生梦想是什么？ 我可能会说：有什么天天嫖麦当劳优惠券狠狠吃更棒的事了呢😋 QQ图片20230211161756 本文所谈及技术只为网络安全人员进行服务器检测或维护参考，仅供学习交流，请勿用于违法用途。 （碰壁了很多次，js代码经过混淆的可读性很差，代码量太大期间火狐崩溃了好几次😭） 页面: aHR0cHM6Ly9jZG4ubWNkLmN..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-08-10T20:00:17.000Z"}],["meta",{"property":"article:author","content":"fullstacksake"}],["meta",{"property":"article:tag","content":"Web"}],["meta",{"property":"article:tag","content":"jsReverse"}],["meta",{"property":"article:tag","content":"SRC"}],["meta",{"property":"article:published_time","content":"2023-02-10T16:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-08-10T20:00:17.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"记一次JS逆向：破解麦当劳 sign 参数加密逻辑\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-02-10T16:00:00.000Z\\",\\"dateModified\\":\\"2024-08-10T20:00:17.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"fullstacksake\\",\\"email\\":\\"fullstacksake@outlook.com\\"}]}"],["meta",{"property":"og:url","content":"https://sakee.cn/sake-s-blog/blogs/jishu/jiyiciJSnixiang：pojiemaidanglao-sign-canshujiamiluoji.html"}],["meta",{"property":"og:site_name","content":"sake's blog"}],["meta",{"property":"og:title","content":"记一次JS逆向：破解麦当劳 sign 参数加密逻辑"}],["meta",{"property":"og:description","content":"如果你问我人生梦想是什么？ 我可能会说：有什么天天嫖麦当劳优惠券狠狠吃更棒的事了呢😋 QQ图片20230211161756 本文所谈及技术只为网络安全人员进行服务器检测或维护参考，仅供学习交流，请勿用于违法用途。 （碰壁了很多次，js代码经过混淆的可读性很差，代码量太大期间火狐崩溃了好几次😭） 页面: aHR0cHM6Ly9jZG4ubWNkLmN..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-08-10T20:00:17.000Z"}],["meta",{"property":"article:author","content":"fullstacksake"}],["meta",{"property":"article:tag","content":"Web"}],["meta",{"property":"article:tag","content":"jsReverse"}],["meta",{"property":"article:tag","content":"SRC"}],["meta",{"property":"article:published_time","content":"2023-02-10T16:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-08-10T20:00:17.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"记一次JS逆向：破解麦当劳 sign 参数加密逻辑\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-02-10T16:00:00.000Z\\",\\"dateModified\\":\\"2024-08-10T20:00:17.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"fullstacksake\\",\\"email\\":\\"fullstacksake@outlook.com\\"}]}"]]},"headers":[],"git":{"createdTime":1723320017000,"updatedTime":1723320017000,"contributors":[{"name":"fullstacksake@gmail.com","email":"64351788+fullstack-sake@users.noreply.github.com","commits":1}]},"filePathRelative":"blogs/技术/记一次JS逆向：破解麦当劳-sign-参数加密逻辑.md"}`);export{B as comp,A as data};
